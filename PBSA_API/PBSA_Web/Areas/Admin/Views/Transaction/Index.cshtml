
@{
    Layout = "~/Areas/Admin/Views/_AdminLayout.cshtml";
}
<link href="~/css/mycss.css" rel="stylesheet" />
<link href="~/css/mytable.css" rel="stylesheet" />
<title>PBSA | Transaction</title>

<div class="container-fluid">
    <h4 class="c-grey-900 mT-10 mB-30">Transaction Management</h4>
    <div class="row">
        <div class="col-md-12">
            <div class="bgc-white bd bdrs-3 p-20 mB-20">
                <table id="transactionTable" class="table table-striped table-bordered">
                    <thead>
                        <tr>
                            <th>Time</th>
                            <th>Sender</th>
                            <th>Reciever</th>
                            <th>Status</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>

    <!--Begin Modal-->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true" style="display: none;">
        <div class="modal-dialog" role="document">
            <div class="mymodal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="myModalLabel">Modal title</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
                </div>
                <div class="modal-body">


                    <table class="my_table">
                        <tbody>
                            <tr>
                                <td class="my_label">Type</td>
                                <td class="my_tdMinWidth"><span id="txtType"></span></td>
                                <td class="my_label">Status</td>
                                <td><span id="txtStatus"></span></td>

                            </tr>
                            <tr>
                                <td class="my_label">Sender</td>
                                <td><span id="txtSender"></span></td>
                                <td class="my_label">Reciever</td>
                                <td><span id="txtReciever"></span></td>
                            </tr>
                            <tr>
                                <td class="my_label">Amount</td>
                                <td><span id="txtAmount"></span></td>
                                <td class="my_label">Currency</td>
                                <td><span id="txtCurrency"></span></td>
                            </tr>
                            <tr>
                                <td class="my_label">Time</td>
                                <td style="width: 20em"><span id="txtTime"></span></td>
                                <td class="my_label">Detail</td>
                                <td colspan="3"><span id="txtDetail"></span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="modal-footer">
                    <button id="btnClose" type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    <!--End Modal-->
</div>

<script src="~/lib/jquery/dist/jquery.js" type="text/javascript"></script>
<script src="~/js/common.js"></script>
<script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js" type="text/javascript"></script>
<script type="text/javascript">
    $(document).ready(function () {
        $('#transactionTable').dataTable({
            "processing": false,
            "serverSide": false,
            "ajax": {
                "url": "/Admin/Transaction/GetTransactions",
                "type": "GET"
            },
            "columns": [
                {
                    width: "20%",
                    data: "time",
                    render: function (data) {
                        return parseDate(data);
                    }
                },
                {
                    "data": "senderName",
                    width: "25%",
                },
                {
                    "data": "receiverName",
                    width: "25%",
                },
                {
                    width: "15%",
                    data: 'state',
                    render: function (data) {
                        if (data == "completed") {
                            return '<span class="c-green-500">Completed</span>';
                        }
                        return data;
                    }
                },
                {
                    data: 'id',
                    render: function (data, type, row) {
                        return '<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#myModal" onclick="ViewTransactionDetail(\'' + data + '\')">View</button>';
                    }
                }
            ]
        });
    });

    function ViewTransactionDetail(id) {
        $.ajax({
            type: "POST",
            url: "/Admin/Transaction/GetTransactionInfo",
            data: { "id": id },
            success: function (data) {
                $('#myModalLabel').text("Transaction's infomation");
                $('#txtType').text(data.type);
                $('#txtSender').text(data.senderName);
                $('#txtReciever').text(data.receiverName);
                $('#txtStatus').text(data.state);
                $('#txtAmount').text(data.amount);
                $('#txtCurrency').text(data.currencyCode);
                $('#txtTime').text(parseDate(data.time));
                $('#txtDetail').text(data.detail);
            }
        });
    }

</script>
