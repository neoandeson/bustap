
@{
    Layout = "~/Areas/Admin/Views/_AdminLayout.cshtml";
}
<link href="~/css/mycss.css" rel="stylesheet" />
<link href="~/css/mytable.css" rel="stylesheet" />
<title>Staff | Customer Management</title>

<div class="container-fluid">
    <div class="row">
        <div class="col-md-12">
            <div class="bgc-white bd bdrs-3 p-20 mB-20">
                <h2 class="c-grey-900 mT-10 mB-30">Customer Management</h2>
                <table id="customerTable" class="table table-striped table-bordered">
                    <thead>
                        <tr>
                            <th>No</th>
                            <th>Username</th>
                            <th>Fullname</th>
                            <th>Phone</th>
                            <th>State</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>

    <!--Begin Modal-->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true" style="display: none;">
        <div class="modal-dialog" role="document">
            <div class="mymodal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="myModalLabel">Modal title</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
                </div>
                <div class="modal-body">
                    <table class="my_table">
                        <tbody>
                            <tr>
                                <td class="my_label width5em">Username</td>
                                <td class="width20em"><span id="txtUserName"></span></td>
                                <td class="my_label">Phone</td>
                                <td><span id="txtContactPhone"></span></td>
                            </tr>
                            <tr>
                                <td class="my_label">FullName</td>
                                <td><span id="txtFullName"></span></td>
                                <td style="width: 2em" class="my_label">State</td>
                                <td><span id="txtActive"></span></td>
                            </tr>
                            <tr>
                                <td class="my_label">Address</td>
                                <td class="my_tdMinWidth" colspan="8"><span id="txtAddress"></span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="modal-footer">
                    <button id="btnClose" type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    <!--End Modal-->
</div>

<script src="~/js/common.js"></script>
<script src="~/lib/jquery/dist/jquery.js" type="text/javascript"></script>
<script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js" type="text/javascript"></script>
<script type="text/javascript">
    $(document).ready(function () {
        DrawTable();
    });

    function DrawTable() {
        $('#customerTable').dataTable().fnDestroy();
        var count = 0;

        $('#customerTable').dataTable({
            "processing": false,
            "serverSide": false,
            "ajax": {
                "url": "localhost:49433/Admin/Customer/GetCustomers",//GetURL("get-all-table"),
                "type": "GET"
            },
            "columns": [
                {
                    width: "7%",
                    render: function (data, type, row, meta) {
                        return meta.row + meta.settings._iDisplayStart + 1;
                    }
                },
                {
                    width: "20%",
                    "data": "username",
                },
                {
                    width: "30%",
                    "data": "fullName"
                },
                {
                    width: "12%",
                    "data": "phone"
                },
                {
                    width: "12%",
                    data: 'isActive',
                    render: function (data, type, row) {
                        if (data == true) {
                            return '<span class="c-green-500">Actived</span>';
                        }
                        return '<span class="c-red-500">Deactived</span>';
                    }
                },
                {
                    data: 'username',
                    render: function (data, type, row) {
                        var viewButton = '<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#myModal" onclick="ViewCustomerDetail(\'' + data + '\')">Detail</button>';
                        var activateButton = '<button type="button" class="btn btn-success" onclick="Activate(\'' + data + '\')">Activate</button>';
                        var deactivateButton = '<button type="button" class="btn btn-danger" onclick="Deactivate(\'' + data + '\')">Deactivate</button>';
                        if (row.isActive) {
                            return viewButton + '&nbsp;' + deactivateButton;
                        }
                        return viewButton + '&nbsp;' + activateButton;
                    }
                }
            ]
        });
    }

    function Deactivate(username) {
        $.ajax({
            type: "POST",
            headers: {
                "Authorization": GetAccessToken(),
            },
            url: GetURL("update-state", { "username": username, "isActive": false }),
            headers: {
                "Authorization": "Bearer " + GetAccessToken(),
            },
            success: function (data) {
                alert(`Deactivate user ${username} Successfully`);
                DrawTable();
            }
        });
    }

    function Activate(username) {
        $.ajax({
            type: "POST",
            headers: {
                "Authorization": GetAccessToken(),
            },
            url: GetURL("update-state", { "username": username, "isActive": true }),
            headers: {
                "Authorization": "Bearer " + GetAccessToken(),
            },
            success: function (data) {
                alert(`Activate user ${username} Successfully`);
                DrawTable();
            }
        });
    }

</script>
