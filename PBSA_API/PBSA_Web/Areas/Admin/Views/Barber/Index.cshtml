
@{
    Layout = "~/Areas/Admin/Views/_AdminLayout.cshtml";
}
<link href="~/css/mycss.css" rel="stylesheet" />
<link href="~/css/mytable.css" rel="stylesheet" />
<title>Staff | Barber Management</title>

<div class="container-fluid">
    <div class="row">
        <div class="col-md-12">
            <div class="bgc-white bd bdrs-3 p-20 mB-20">
                <h1 class="mT-10 mB-30" style="color: black">Barber Management</h1>
                <table id="barberTable" class="table table-striped table-bordered">
                    <thead>
                        <tr>
                            <th>No</th>
                            <th>Username</th>
                            <th>Fullname</th>
                            <th>Phone</th>
                            <th>State</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>

    <!--Begin Modal-->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true" style="display: none;">
        <div class="modal-dialog" role="document">
            <div class="mymodal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="myModalLabel">Modal title</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
                </div>
                <div class="modal-body">
                    <table class="my_table">
                        <tbody>
                            <tr>
                                <td class="my_label width5em">Username</td>
                                <td class="width20em"><span id="txtUserName"></span></td>
                                <td class="my_label width5em">Phone</td>
                                <td><span id="txtContactPhone"></span></td>
                            </tr>
                            <tr>
                                <td class="my_label">FullName</td>
                                <td><span id="txtFullName"></span></td>
                                <td class="my_label">Rate</td>
                                <td><span id="txtOverallRate"></span></td>
                            </tr>
                            <tr>
                                <td class="my_label">District</td>
                                <td><span id="txtDistrict"></span></td>
                                <td class="my_label">City</td>
                                <td><span id="txtCity"></span></td>
                            </tr>
                            <tr>
                                <td class="my_label">Address</td>
                                <td colspan="8"><span id="txtAddress"></span></td>
                            </tr>
                            <tr>
                                <td class="my_label">State</td>
                                <td><span id="txtActive"></span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="modal-footer">
                    <button id="btnClose" type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    <!--End Modal-->
</div>

<script src="~/js/common.js"></script>
<script src="~/lib/jquery/dist/jquery.js" type="text/javascript"></script>
<script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js" type="text/javascript"></script>
<script type="text/javascript">
    $(document).ready(function () {
        DrawTable();
    });

    function DrawTable() {
        $("#barberTable").dataTable().fnDestroy()

        $('#barberTable').dataTable({
            "processing": false,
            "serverSide": false,
            "destroy": true,
            "ajax": {
                "headers": {
                    "Authorization": "Bearer " + GetAccessToken(),
                },
                "url": GetURL("barber/get-all-table"),
                "type": "GET"
            },
            "columns": [
                {
                    width: "7%",
                    render: function (data, type, row, meta) {
                        return meta.row + meta.settings._iDisplayStart + 1;
                    }
                },
                {
                    data: "username",
                    width: "20%"
                },
                {
                    data: "fullName",
                    width: "30%"
                },
                {
                    data: "contactPhone",
                    width: "12%"
                },
                {
                    data: 'isActive',
                    width: "12%",
                    render: function (data, type, row) {
                        if (data == true) {
                            return '<span class="c-green-500">Activated</span>';
                        }
                        return '<span class="c-red-500">Deactivated</span>';
                    }
                },
                {
                    data: 'username',
                    render: function (data, type, row) {
                        var viewButton = '<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#myModal" onclick="ViewBarberDetail(\'' + data + '\')">Detail</button>';
                        var activateButton = '<button type="button" class="btn btn-success" onclick="Activate(\'' + data + '\')">Activate</button>';
                        var deactivateButton = '<button type="button" class="btn btn-danger" onclick="Deactivate(\'' + data + '\')">Deactivate</button>';
                        if (row.isActive) {
                            return viewButton + '&nbsp;' + deactivateButton;
                        }
                        return viewButton + '&nbsp;' + activateButton;
                    }
                }
            ]
        });
    }

    function ViewBarberDetail(username) {
        $.ajax({
            type: "GET",
            url: GetURL("barber/get-info", { "username": username }),
            headers: {
                "Authorization": "Bearer " + GetAccessToken(),
            },
            success: function (data) {
                $('#myModalLabel').text(data.username + "'s infomation");
                $('#txtUserName').text(data.username);
                $('#txtFullName').text(data.fullName);
                $('#txtContactPhone').text(data.contactPhone);
                $('#txtOverallRate').text(data.overallRate);
                $('#txtRatingCount').text(data.ratingCount);
                $('#txtAddress').text(data.address);
                $('#txtDistrict').text(data.district);
                $('#txtCity').text(data.city);
                if (data.isActive == true) {
                    $('#txtActive').text("Activate");
                } else {
                    $('#txtActive').text("Deactive");
                }
            }
        });
    }

    function Deactivate(username) {
        $.ajax({
            type: "POST",
            headers: {
                "Authorization": GetAccessToken(),
            },
            url: GetURL("barber/update-state", { "username": username, "isActive": false }),
            headers: {
                "Authorization": "Bearer " + GetAccessToken(),
            },
            success: function (data) {
                alert(`Deactivate user ${username} Successfully`);
                DrawTable();
            }
        });
    }

    function Activate(username) {
        $.ajax({
            type: "POST",
            headers: {
                "Authorization": GetAccessToken(),
            },
            url: GetURL("barber/update-state", { "username": username, "isActive": true }),
            headers: {
                "Authorization": "Bearer " + GetAccessToken(),
            },
            success: function (data) {
                alert(`Activate user ${username} Successfully`);
                DrawTable();
            }
        });
    }

</script>
